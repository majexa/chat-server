// Generated by CoffeeScript 1.11.1
(function() {
  new Request({
    url: '/dev/cleanupChat/57e9120d8e2016833717515f/580b4d3d2aa614094c58cff5',
    onComplete: function() {
      var chat1, chat2, messages1, messages2, newMessages, newMessages2, user1, user2;
      user1 = {
        login: 'Anton',
        password: '888',
        device: 'android'
      };
      user2 = {
        login: '123123',
        password: 'null',
        device: 'android'
      };
      chat1 = new Chat(user1, '580b4d3d2aa614094c58cff5');
      chat1.bind('joined', function() {
        return chat1.sendMessage('TEST');
      });
      chat1.start();
      chat2 = new Chat(user2, '57e9120d8e2016833717515f');
      chat2.start();
      newMessages2 = [];
      chat2.bind('newMessage', function(data) {
        newMessages2.push(data);
        return setTimeout(function() {
          return chat2.restart();
        }, 50);
      });
      newMessages = [];
      chat1.bind('newMessage', function(data) {
        return newMessages.push(data);
      });
      messages1 = [];
      chat1.bind('messages', function(data) {
        return messages1 = data.messages;
      });
      messages2 = [];
      chat2.bind('messages', function(data) {
        return messages2 = data.messages;
      });
      return setTimeout(function() {
        var _id;
        if (newMessages.length !== 1) {
          throw new Error('test 1 filed');
        }
        if (newMessages[0].message.userId !== '57e9120d8e2016833717515f') {
          throw new Error('test 2 filed');
        }
        if (newMessages2.length !== 1) {
          throw new Error('test 3 filed');
        }
        if (messages2[0].userId !== '57e9120d8e2016833717515f') {
          throw new Error('test 4 filed');
        }
        if (messages2[0].viewed !== false) {
          throw new Error('test 5 filed');
        }
        _id = messages2[0]._id;
        messages1 = [];
        return new Request({
          url: '/api/v1/message/markAsViewed',
          onComplete: function() {
            chat1.restart();
            return setTimeout(function() {
              if (messages1.length !== 0) {
                throw new Error('test 6 filed');
              }
              if (messages2.length !== 1) {
                throw new Error('test 7 filed');
              }
            }, 1000);
          }
        }).get({
          token: chat1.token,
          _ids: _id
        });
      }, 1000);
    }
  }).get();

}).call(this);

//# sourceMappingURL=auth.js.map
